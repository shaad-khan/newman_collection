{
	"info": {
		"_postman_id": "99923c92-2cba-428a-9533-c5886ce19494",
		"name": "new_collection",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "https://admin.aspqa01us.acuitynext.io/{{variable_key}}",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"id": "449ae809-31e5-45e3-b45f-7b0355df1b70",
						"type": "text/javascript",
						"exec": [
							"/* Author: Shadab PostTest-Script */",
							"",
							"var _ = require('lodash');",
							"var parseString = require('xml2js').parseString;",
							"//var encodedPat = encodePat('72cwherppis2lgz5gjcrahj6bunq5g5fhfdslkawzy6ie2lk24wa');",
							"var encodedPat = encodePat('ptespah6ggnrwlsofomzxjlq4v6yzv6uubu6qmt4zuaolrwzx4na');",
							"function encodePat(pat) {",
							"",
							"  var b = new Buffer(':' + pat);",
							"",
							"   var s = b.toString('base64');",
							"",
							"return s;",
							"",
							"}",
							"",
							"pm.sendRequest({",
							"",
							"   // url: 'https://testshaad.visualstudio.com/newmantest/_apis/wit/workitems/173?fields=Microsoft.VSTS.TCM.Steps&api-version=4.1-preview',",
							"      url: \"https://ablcode.visualstudio.com/QualityAssurance/_apis/wit/workitems/139092?fields=Microsoft.VSTS.TCM.Steps&api-version=4.1-preview\",",
							"",
							"    method: 'GET',",
							"",
							"    header: {'cache-control': 'no-cache', 'authorization': `Basic ${encodedPat}`,'Content-Type': 'application/json-patch+json'},",
							"  body: {},",
							"  json:true",
							"",
							"     ",
							" ",
							"}, function (err,res) {",
							"  ",
							"    var r=res.json();",
							"    var x=_.pick(r.fields,['Microsoft.VSTS.TCM.Steps']);",
							"  x=x['Microsoft.VSTS.TCM.Steps'];",
							"parseString(x, function (err, result) {",
							"          var api=result.steps.step[1].parameterizedString[1]._;   ",
							"      var r=result.steps.step[0].parameterizedString[1]._;",
							"     ",
							"      r=r.replace(\"&nbsp;\",'');",
							"      r=r.replace(/<[^>]+>/g, '');",
							"      ",
							"      api=api.replace(\"&nbsp;\",'');",
							"      api=api.replace(/<[^>]+>/g, '');",
							"/*   var y=r.split(\":\");",
							"   //console.log(y[1]);*/",
							"   pm.environment.set(\"response_code\", r);",
							"  // pm.environmnt.set(\"call\",\"api/v1/partners\");",
							"  pm.environment.set(\"variable_key\", api);",
							"    ",
							"});",
							"",
							"",
							"",
							"",
							"",
							"});",
							"var d = new Date();",
							"",
							"/*pm.sendRequest({",
							"",
							"   // url: 'https://testshaad.visualstudio.com/newmantest/_apis/test/runs?api-version=1.0',",
							"   url: 'https://ablcode.visualstudio.com/QualityAssurance/_apis/test/runs?api-version=1.0',",
							"    method: 'POST',",
							"",
							"    header: {'cache-control': 'no-cache', 'authorization': `Basic ${encodedPat}`,'Content-Type': 'application/json'},",
							"  body: {",
							"  ",
							"  mode: 'raw',",
							"",
							"        raw: JSON.stringify({",
							"      \"name\":\"NEWTEST\"+Date.now(),",
							"  \"state\":\"InProgress\",",
							"   \"plan\": {",
							"    \"id\": 110751",
							"  },",
							"  \"startedDate\":d,",
							"  \"isAutomated\": false,",
							"  \"comment\": \"Automating Testing Using Postman/Newman\"",
							"  })",
							" ",
							"}}, function (err,res) {",
							"  ",
							"  console.log(\"pre\"+res.json().id);",
							"    pm.globals.set(\"testrun\", res.json().id);",
							"})",
							"",
							"*/",
							"",
							"/* Shadab Pre-Script */",
							"",
							""
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"id": "a0dd54df-7d09-4c84-8439-1661f7b9e261",
						"type": "text/javascript",
						"exec": [
							"/* Author: Shadab PostTest-Script */",
							"",
							"",
							"var partnerCountAll = 9;//data.partnerCountAll;",
							"",
							"var property1 = \"partnerID\";//data.property1;",
							"",
							"var property2 = \"partnerKey\";//data.property1;",
							"",
							"var property3 = \"partnerName\";//data.property1;",
							"//var encodedPat = encodePat('72cwherppis2lgz5gjcrahj6bunq5g5fhfdslkawzy6ie2lk24wa');",
							"var encodedPat = encodePat('ptespah6ggnrwlsofomzxjlq4v6yzv6uubu6qmt4zuaolrwzx4na');",
							"function encodePat(pat) {",
							"",
							"  var b = new Buffer(':' + pat);",
							"",
							"   var s = b.toString('base64');",
							"",
							"",
							"",
							"return s;",
							"",
							"",
							"",
							"}",
							"",
							"",
							"//xhttp = new XMLHttpRequest();",
							"",
							"var rcode=pm.environment.get(\"response_code\");",
							"var testrunid=pm.globals.get(\"testrun\");",
							"console.log(\"post\"+testrunid);",
							"rcode=parseInt(rcode);",
							"",
							"    pm.test('Atrius.Partner.GetPartnerAll: Status code Expected: 200, Actual: '+ rcode,function () {",
							"  try{",
							"        pm.response.to.have.status(rcode);",
							"       /* passed();",
							"       setTimeout(function() {",
							"update_run();",
							"}, 5000);",
							"update_run();",
							"         */",
							"        ",
							"        }",
							"        catch(err)",
							"        {",
							"      //  send(err);",
							"        /*setTimeout(function() {",
							"update_run();",
							"}, 5000);",
							"        update_run(); ",
							" */",
							"  throw err;",
							"        }",
							"",
							"    });",
							"",
							"function send(e)",
							"{",
							"    console.log(e.message);",
							"",
							"",
							"",
							"return new Promise(function(resolve, reject) {",
							"pm.sendRequest({",
							"",
							"",
							"    //url: `https://testshaad.visualstudio.com/newmantest/_apis/test/runs/${testrunid}/results?api-version=3.0-preview`,",
							"    url: `https://ablcode.visualstudio.com/QualityAssurance/_apis/test/runs/${testrunid}/results?api-version=3.0-preview`,",
							"",
							"    method: 'POST',",
							"",
							"    header: {'cache-control': 'no-cache', 'authorization': `Basic ${encodedPat}`,'Content-Type': 'application/json'},",
							" body: {",
							"      mode: 'raw',",
							"",
							"        raw: JSON.stringify(",
							"            [{",
							"  \t",
							"  \t\"testCase\": {",
							"\"id\": 139092",
							"},\"testPoint\": {",
							"    \"id\":127699",
							"  },",
							"    ",
							"    \"priority\": 2,",
							"    \"outcome\": \"Failed\",",
							"    \"errorMessage\": e.message",
							"  }]",
							"            ",
							"            )",
							"",
							"     ",
							" }",
							"}, function (err, res) {",
							"",
							"   console.log(res.code);",
							"   return resolve(res.code);",
							"",
							"});",
							"});",
							"",
							"}",
							"",
							"/*************--------------------------------------------*//////////////////////",
							"",
							"function update_run()",
							"{",
							"   // var interval = setTimeout(function() {}, 10000),",
							"   //var promise = new Promise(function(resolve, reject) {",
							"    //console.log(\"inside update\");",
							"    ",
							"var d = new Date();",
							"",
							"pm.sendRequest({",
							"",
							"    url: `https://ablcode.visualstudio.com/QualityAssurance/_apis/test/runs/${testrunid}?api-version=3.0`,",
							"",
							"    method: 'PATCH',",
							"",
							"    header: {'cache-control': 'no-cache', 'authorization': `Basic ${encodedPat}`,'Content-Type': 'application/json'},",
							"  body: {",
							"  ",
							"  mode: 'raw',",
							"",
							"        raw: JSON.stringify({",
							"      ",
							"  \"state\":\"Completed\"",
							"  })",
							" ",
							"}}, function (err,res) {",
							"    if(err)",
							"    {",
							"        console.log(\"inside func\");",
							"        console.log(err);",
							"    }",
							"  ",
							"});",
							"",
							"",
							"}",
							"",
							"",
							"function passed()",
							"    {",
							"",
							"    return new Promise(function(resolve, reject) {    ",
							"     pm.sendRequest({",
							"",
							"    url: `https://ablcode.visualstudio.com/QualityAssurance/_apis/test/runs/${testrunid}/results?api-version=3.0-preview`,",
							"",
							"    method: 'POST',",
							"",
							"    header: {'cache-control': 'no-cache', 'authorization': `Basic ${encodedPat}`,'Content-Type': 'application/json'},",
							" body: {",
							"      mode: 'raw',",
							"",
							"        raw: JSON.stringify(",
							"            [{",
							"  \t",
							"  \t\"testCase\": {",
							"\"id\": 139092",
							"},\"testPoint\": {",
							"    \"id\":127699",
							"  },",
							"    ",
							"    \"priority\": 2,",
							"    \"outcome\": \"Passed\",",
							"    \"errorMessage\": \"passed with response code 200\"",
							"  }]",
							"            ",
							"            )",
							"",
							"     ",
							" }",
							"}, function (err, res) {",
							"",
							"   console.log(res.code);",
							" return resolve(res.code);",
							"});",
							"",
							"});",
							"",
							"}",
							"",
							"/* Shadab PostTest-Script */"
						]
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [
					{
						"key": "atr-subscription-key",
						"value": "fa734f6a8f544f6c99e462de74e689eb"
					},
					{
						"key": "atr-partner-id",
						"value": "F8920659-D3AF-4823-90C0-276C48FA9DFD"
					},
					{
						"key": "atr-request-source",
						"value": "TestWeb"
					}
				],
				"body": {},
				"url": {
					"raw": "https://admin.aspqa01us.acuitynext.io/{{variable_key}}",
					"protocol": "https",
					"host": [
						"admin",
						"aspqa01us",
						"acuitynext",
						"io"
					],
					"path": [
						"{{variable_key}}"
					]
				}
			},
			"response": []
		}
	]
}